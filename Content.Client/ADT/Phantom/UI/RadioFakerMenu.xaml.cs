using Content.Client.UserInterface.Controls;
using Content.Shared.Radio;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Prototypes;

namespace Content.Client.ADT.Phantom.UI;

[GenerateTypedNameReferences]
public sealed partial class RadioFakerMenu : FancyWindow
{
    [Dependency] private readonly IPrototypeManager _proto = default!;

    public NetEntity Target = NetEntity.Invalid;

    private List<string> _channels = new();
    public Action<string, string, string>? OnSend;

    public RadioFakerMenu()
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);
        SendButton.OnPressed += args => OnSend?.Invoke(_channels[ChannelButton.SelectedId], NameEdit.Text, TextEdit.Text);
        ChannelButton.OnItemSelected += args => ChannelButton.Select(args.Id);
    }

    public void Populate(List<string> channels)
    {
        ChannelButton.Clear();
        _channels = channels;

        for (var i = 0; i < channels.Count; i++)
        {
            var item = channels[i];
            var proto = _proto.Index<RadioChannelPrototype>(item);

            ChannelButton.AddItem(proto.Name, i);
        }

        ChannelButton.Select(0);
    }
}
