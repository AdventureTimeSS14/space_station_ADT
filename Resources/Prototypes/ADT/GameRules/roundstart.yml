- type: entityTable
  id: RampingGameRulesTable
  table: !type:AllSelector
    children:
      - !type:NestedSelector
        tableId: BasicCalmEventsTable
      - !type:NestedSelector
        tableId: BasicAntagEventsTable
      - !type:NestedSelector
        tableId: CargoGiftsTable

- type: entity
  abstract: true
  parent: BaseGameRule
  id: BaseHereticRule
  components:
  - type: HereticRule
  - type: AntagSelection

- type: entity
  parent: BaseHereticRule
  id: Heretic
  components:
  - type: HereticRule
  - type: GameRule
    minPlayers: 25
  - type: AntagSelection
    agentName: heretic-roundend-name
    definitions:
    - prefRoles: [ Heretic ]
      max: 4
      playerRatio: 15
      lateJoinAdditional: true
      mindComponents:
      - type: HereticRole

- type: entity
  parent: BaseHereticRule
  id: HereticSoloGameRule
  components:
  - type: HereticRule
  - type: GameRule
    minPlayers: 25
  - type: AntagSelection
    agentName: heretic-roundend-name
    definitions:
    - prefRoles: [ Heretic ]
      max: 1
      playerRatio: 15
      lateJoinAdditional: true
      mindComponents:
      - type: HereticRole

- type: entityTable
  id: ExtendedGameRulesTable
  table: !type:AllSelector
    children:
      - !type:NestedSelector
        tableId: BasicCalmEventsTable
      - !type:NestedSelector
        tableId: CargoGiftsTable
      - !type:NestedSelector
        tableId: CalmPestEventsTable
      - !type:NestedSelector
        tableId: SpicyPestEventsTable

- type: entity
  id: ExtendedStationEventScheduler
  parent: BaseGameRule
  components:
  - type: BasicStationEventScheduler
    scheduledGameRules: !type:NestedSelector
      tableId: ExtendedGameRulesTable

- type: entity
  parent: BaseGameRule
  id: ChangelingGameRule
  components:
  - type: ChangelingRule
  - type: GameRule
    minPlayers: 25
    delay:
      min: 30
      max: 60
  - type: AntagSelection
    definitions:
    - prefRoles: [ Changeling ]
      max: 5
      playerRatio: 15
      blacklist:
        components:
        - AntagImmune
        tags:
        - ChangelingBlacklist
      lateJoinAdditional: true
      mindRoles:
      - MindRoleChangeling
      components:
      - type: Changeling
    agentName: ling-round-end-name
  - type: AntagRandomObjectives
    sets:
    - groups: ChangelingObjectiveGroups
    maxDifficulty: 5

#Облегченное число агентов
- type: entity
  parent: BaseTraitorRule
  id: TraitorLightGameRule
  components:
  - type: GameRule
    minPlayers: 5
    delay:
      min: 240
      max: 420
  - type: AntagSelection
    selectionTime: IntraPlayerSpawn
    definitions:
    - prefRoles: [ Traitor ]
      max: 4          
      playerRatio: 15 
      blacklist:
        components:
        - AntagImmune
      lateJoinAdditional: true
      mindRoles:
      - MindRoleTraitor

#Пары из антагов
- type: entity
  parent: BaseTraitorRule
  id: TraitorDuoGameRule
  components:
  - type: GameRule
    minPlayers: 20
    delay:
      min: 240
      max: 420
  - type: AntagSelection
    selectionTime: IntraPlayerSpawn
    definitions:
    - prefRoles: [ Traitor ]
      max: 2       
      playerRatio: 10
      blacklist:
        components:
        - AntagImmune
      lateJoinAdditional: true
      mindRoles:
      - MindRoleTraitor

- type: entity
  parent: BaseGameRule
  id: ChangelingDuoGameRule
  components:
  - type: ChangelingRule
  - type: GameRule
    minPlayers: 20
    delay:
      min: 30
      max: 60
  - type: AntagSelection
    definitions:
    - prefRoles: [ Changeling ]
      max: 2
      playerRatio: 15
      blacklist:
        components:
        - AntagImmune
        tags:
        - ChangelingBlacklist
      lateJoinAdditional: true
      mindRoles:
      - MindRoleChangeling
      components:
      - type: Changeling
    agentName: ling-round-end-name
  - type: AntagRandomObjectives
    sets:
    - groups: ChangelingObjectiveGroups
    maxDifficulty: 5

- type: entity
  parent: BaseHereticRule
  id: HereticDuoGameRule
  components:
  - type: HereticRule
  - type: GameRule
    minPlayers: 20
  - type: AntagSelection
    agentName: heretic-roundend-name
    definitions:
    - prefRoles: [ Heretic ]
      max: 2
      playerRatio: 15
      lateJoinAdditional: true
      mindComponents:
      - type: HereticRole

- type: entity
  id: DynamicHardGamerule
  parent: BaseGameRule
  components:
  - type: DynamicRule
    maxEventsBeforeAntag: 8
    maxChaos: 120
    minChaos: 80
    scheduledGameRules: !type:NestedSelector
      tableId: RampingGameRulesTable
    roundstartRules:
      - id: Thief
        cost: 10
      - id: HereticDuoGameRule
        cost: 20
        rerollChance: 0.5
      - id: HereticSoloGameRule
        cost: 10
        rerollChance: 0.5
      - id: ChangelingDuoGameRule
        cost: 10
      - id: TraitorDuoGameRule
        cost: 10
      - id: TraitorLightGameRule
        cost: 15
      - id: ChangelingGameRule
        cost: 25
      - id: Heretic
        cost: 30
        rerollChance: 0.5
      - id: Revolutionary
        cost: 45
      - id: Zombie
        cost: 60
    midroundAntags:
      - id: DragonSpawn
        cost: 100
      - id: Pirates
        cost: 120
      - id: PhantomSpawn
        cost: 110
      # - id: MorphSpawn #TODO: Раскомментить после фикса
      #   cost: 130
      - id: NinjaSpawn
        cost: 140
      - id: KingRatMigration
        cost: 90
      - id: ParadoxCloneSpawn
        cost: 90
      - id: SleeperAgents
        cost: 100

- type: entity
  id: DynamicMediumGamerule
  parent: BaseGameRule
  components:
  - type: DynamicRule
    maxEventsBeforeAntag: 9
    maxChaos: 60
    minChaos: 50
    scheduledGameRules: !type:NestedSelector
      tableId: RampingGameRulesTable
    roundstartRules:
      - id: Thief
        cost: 10
      - id: HereticDuoGameRule
        cost: 20
        rerollChance: 0.5
      - id: HereticSoloGameRule
        cost: 15
        rerollChance: 0.5
      - id: ChangelingDuoGameRule
        cost: 15
      - id: TraitorDuoGameRule
        cost: 15
      - id: TraitorLightGameRule
        cost: 15
      - id: ChangelingGameRule
        cost: 25
      - id: Heretic
        cost: 30
        rerollChance: 0.5
      - id: Nukeops
        cost: 50
      - id: Revolutionary
        cost: 35
    midroundAntags:
      - id: DragonSpawn
        cost: 110
      - id: Pirates
        cost: 130
      - id: PhantomSpawn
        cost: 120
      # - id: MorphSpawn #TODO: Раскомментить после фикса
      #   cost: 140
      - id: NinjaSpawn
        cost: 150
      - id: KingRatMigration
        cost: 90
      - id: ParadoxCloneSpawn
        cost: 90
      - id: SleeperAgents
        cost: 110

- type: entity
  id: DynamicLightGamerule
  parent: BaseGameRule
  components:
  - type: DynamicRule
    maxEventsBeforeAntag: 10
    maxChaos: 40
    minChaos: 20
    scheduledGameRules: !type:NestedSelector
      tableId: ExtendedGameRulesTable
    roundstartRules:
      - id: Thief
        cost: 10
      - id: ChangelingDuoGameRule
        cost: 10
      - id: TraitorDuoGameRule
        cost: 10
      - id: TraitorLightGameRule
        cost: 15
      - id: ChangelingGameRule
        cost: 25
    midroundAntags:
      - id: DragonSpawn
        cost: 110
      - id: Pirates
        cost: 130
      - id: PhantomSpawn
        cost: 120
      # - id: MorphSpawn #TODO: Раскомментить после фикса
      #   cost: 140
      - id: NinjaSpawn
        cost: 150
      - id: KingRatMigration
        cost: 90
      - id: ParadoxCloneSpawn
        cost: 90
      - id: SleeperAgents
        cost: 110

- type: entity
  id: DynamicRandomGamerule
  parent: BaseGameRule
  components:
  - type: GameRule
    minPlayers: 30
  - type: DynamicRandomRule
