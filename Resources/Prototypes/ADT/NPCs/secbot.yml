- type: htnCompound
  id: SecbotCompound
  branches:
    - tasks:
        - !type:HTNCompoundTask
          task: ArrestWantedNearbyCompound
    - tasks:
        - !type:HTNCompoundTask
          task: ArrestContrabandNearbyCompound
    - tasks:
        - !type:HTNCompoundTask
          task: MeleeCombatCompound
    - tasks:
        - !type:HTNCompoundTask
          task: SecbotPatrolCompound

- type: htnCompound
  id: ArrestWantedNearbyCompound
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:PickNearbyWantedOperator
            targetKey: StunTarget
            targetMoveKey: TargetCoordinates
            targetFoundSoundKey: TargetFoundSound

        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: false
            removeKeyOnFinish: false

        - !type:HTNCompoundTask
          task: ArrestTargetCompound

- type: htnCompound
  id: ArrestContrabandNearbyCompound
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:PickNearbyContrabandOperator
            targetKey: ContrabandTarget
            targetMoveKey: ContrabandTargetCoordinates
            targetFoundSoundKey: TargetFoundSound
            excludedJobs:
            - SecurityOfficer
            - Warden
            - HeadOfSecurity
            - Detective
            - SecurityCadet
            - Brigmedic
            - ADTGuardOfficer
            - ADTSeniorOfficer
            - ADTBlueShieldOfficer
            - Captain
            - CentralCommandOfficial
            - CBURN

        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            targetKey: ContrabandTargetCoordinates
            pathfindInPlanning: false
            removeKeyOnFinish: false

        - !type:HTNCompoundTask
          task: ArrestContrabandTargetCompound

- type: htnCompound
  id: ArrestTargetCompound
  branches:
    - preconditions:
        - !type:TargetStunnedPrecondition
          stunned: true
          targetKey: StunTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:ForceHandcuffOperator
            targetKey: StunTarget
            targetArrestedSoundKey: TargetArrestedSound
        - !type:HTNPrimitiveTask
          operator: !type:SendRadioOperator
            message: securitron-target-arrested
            radioChannel: Security
            key: StunTarget

    - preconditions:
        - !type:TargetStunnedPrecondition
          stunned: false
          targetKey: StunTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MeleeOperator
            targetKey: StunTarget

- type: htnCompound
  id: ArrestContrabandTargetCompound
  branches:
    - preconditions:
        - !type:TargetStunnedPrecondition
          stunned: true
          targetKey: ContrabandTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:ForceHandcuffOperator
            targetKey: ContrabandTarget
            targetArrestedSoundKey: TargetArrestedSound
        - !type:HTNPrimitiveTask
          operator: !type:SendRadioOperator
            message: securitron-contraband-arrested
            radioChannel: Security
            key: ContrabandTarget

    - preconditions:
        - !type:TargetStunnedPrecondition
          stunned: false
          targetKey: ContrabandTarget
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MeleeOperator
            targetKey: ContrabandTarget

- type: htnCompound
  id: SecbotPatrolCompound
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:EntityWhitelistOperator
            whitelist:
              components:
              - NavMapBeacon
            targetKey: PatrolTarget
            targetMoveKey: PatrolCoordinates
            listKey: PatrolTargets

        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: false
            stopOnLineOfSight: true
            targetKey: PatrolCoordinates
            rangeKey: VisionRange
